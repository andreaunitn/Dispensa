<!DOCTYPE html>
<html>
    <head>
        <title>
            La Dispensa
        </title>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <link rel="icon" href="https://raw.githubusercontent.com/andreaunitn/Dispensa/cercaRicette/Immagini/forchetta.png">

        <style>
            .barra_nav {
                background-color: #63bb66;
                display: flex;
                justify-content: center;
                list-style-type: none;
                margin: 0;
                padding: 0;
                overflow: hidden;
                width:100%;
            }

            /* Change the link color to #111 (black) on hover */
            li a:hover {
                font-family:Helvetica;
                background-color: #111;
                color: #63bb66;
                text-decoration: none
            }
            .active {
                font-family:Helvetica;
                color: black;
                background-color: #63bb66;
                text-align: center;
                text-decoration: underline;
                padding: 14px 16px;
                display: block;
                text-decoration: none
            }
            .leftside, .rightside {
              height:100vh;
              width:100%
            }

            .btn2 {
              background-color: #c9d2d4;
              margin: 5px;
              color: black;
              padding: 5px;
              border-radius: 8px;
              border: none;
              cursor: pointer;
              width: 130px;
              height: 20px;
              opacity: 0.8;
              box-sizing : content-box;
            }

            .btn3 {
              background-color: #05CAFF;
              margin: 5px;
              color: black;
              padding: 20px;
              border-radius: 8px;
              border: none;
              cursor: pointer;
              width: 130px;
              height: 20px;
              opacity: 0.8;
              box-sizing : content-box;
            }

            .autocomplete {
              position: relative;
              display: inline-block;
            }

            input {
              border: 1px solid transparent;
              background-color: #f1f1f1;
              padding: 10px;
              font-size: 16px;
            }

            input[type=text] {
              background-color: #f1f1f1;
              width: 100%;
            }

            input[type=submit] {
              background-color: DodgerBlue;
              color: #fff;
              cursor: pointer;
            }

            .autocomplete-items {
              position: absolute;
              border: 1px solid #d4d4d4;
              border-bottom: none;
              border-top: none;
              z-index: 99;
              /*position the autocomplete items to be the same width as the container:*/
              top: 100%;
              left: 0;
              right: 0;
            }

            .autocomplete-items div {
              padding: 10px;
              cursor: pointer;
              background-color: #fff;
              border-bottom: 1px solid #d4d4d4;
            }

            /*when hovering an item:*/
            .autocomplete-items div:hover {
              background-color: #e9e9e9;
            }

            /*when navigating through the items using the arrow keys:*/
            .autocomplete-active {
              background-color: DodgerBlue !important;
              color: #ffffff;
}
         </style>

    </head>

    <body  style="background-color: #cfbfab; font-family:Helvetica" onload="start()">

      <div w3-include-html="header.html"></div>

      <div class="container">

        <h1 style="color: #333; margin-bottom: 0px;">
            Dispensa
        </h1>
        <img src="https://raw.githubusercontent.com/andreaunitn/Dispensa/cercaRicette/Immagini/forchetta.png" style="width: 200px; height: 150px; margin-top: 0px; margin-left: 0px;">

        <br>

              <h3>
                  Ecco i tuoi ingredienti disponibili:
              </h3>

              <span id="lista_ingredienti">
              </span>

      </div>

      <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
      <script>

      ingredienti_da_stampare=[]
      rootUrl = window.location

      function loadIngredienti() {

        $.ajax({
            type: 'GET',
            url: 'http://localhost:3000/api/v1/users/me',
            data: {token: localStorage.getItem('token')},
            datatype: 'json',
            success: function (data) {

              var res = data.ingredienti;

              var span = document.getElementById('lista_ingredienti')
              //ingredienti_da_stampare=localStorage.getItem('ingredienti')

              if ( res !== []  ) {

                ingredienti_da_stampare = res

                for (var i = 0; i < ingredienti_da_stampare.length; i++) {
                  var button = document.createElement('button')

                  const ingr = ingredienti_da_stampare[i]

                  button.textContent = ingr
                  button.classList.add('btn2')
                  button.id = ingr
                  button.onclick = function () {
                    console.log('laters gators')

                  }
                  span.appendChild(button)
                }
              } else {
                document.getElementById("lista_ingredienti").innerHTML = "Lista vuota... "
              }

            }
        });

      }

      $(document).ready(function(){
        //const token = localStorage.getItem("user")
        //Token di prova

        $.ajax({
            type: 'GET',
            url: 'http://localhost:3000/api/v1/users/me',
            data: {token: localStorage.getItem('token')},
            datatype: 'json',
            success: function (data) {

              document.getElementById('login').innerHTML='Ciao, '+data.nome
              document.getElementById('login').setAttribute('onclick','window.location.replace("/myProfile")')
            },
            error: function (data) {
              document.getElementById('login').innerHTML='Accedi'
            }
        });
      });


      function start() {

        loadIngredienti()




      }

      function includeHTML() {
          var z, i, elmnt, file, xhttp;
          /* Loop through a collection of all HTML elements: */
          z = document.getElementsByTagName("*");
          for (i = 0; i < z.length; i++) {
            elmnt = z[i];
            /*search for elements with a certain atrribute:*/
            file = elmnt.getAttribute("w3-include-html");
            console.log(file)
            if (file) {
              /* Make an HTTP request using the attribute value as the file name: */
              xhttp = new XMLHttpRequest();
              xhttp.onreadystatechange = function() {
                if (this.readyState == 4) {
                  if (this.status == 200) {elmnt.innerHTML = this.responseText;}
                  if (this.status == 404) {elmnt.innerHTML = "Page not found.";}
                  /* Remove the attribute, and call this function once more: */
                  elmnt.removeAttribute("w3-include-html");
                  includeHTML();
                }
              }
              xhttp.open("GET", file, true);
              xhttp.send();
              /* Exit the function: */
              return;
            }
          }
        }

        includeHTML();
      </script>
    </body>
</html>
