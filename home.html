<!DOCTYPE html>
<html>
    <head>
        <title>
            La Dispensa
        </title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    
        <style>
            ul {
                list-style-type: none;
                margin: 0;
                padding: 0;
                overflow: hidden;
                background-color: #333;
            }
 
            li {
                float: left;
            }
            
            li a {
                display: block;
                color: white;
                text-align: center;
                padding: 14px 16px;
                text-decoration: none;
            }
            
            /* Change the link color to #111 (black) on hover */
            li a:hover {
                background-color: #111;
            }
            .active {
                background-color: #63bb66;
            }
            
            li a {
                color: #666;
            }
         </style>
    
    </head>

    <body class="container" style="background-color: #ccffeb">
        <h1 style="color: #333;">
            Dispensa
        </h1>
        <br>

        <ul style="float:center"> 
            <li><a class="active" href="home.js">RICETTE</a></li>
            <li><a class="active" href="">ACQUISTI</a></li>
            <li><a class="active" href="">DISPENSA</a></li>
        </ul>
        <br><br>
        <h4>
            Inserisci gli ingredienti
        </h4>
        <input type="text", id="ingrediente">
        <button onclick="add_ingredient()", id="submit">Inserisci ingrediente</button>
        <br><br>
        <h4>
            Ingredienti:
        </h4>
        <span id="lista_ingredienti"></span>
        <br><br>
        <h4>
            Ricette consigliate:
        </h4>
        <div id="lista_ricette"></div>
        <div id="ricetta_dettaglio"></div>
    </body>
    <script>

        ingredienti = []

        function cercaRicette() {

          $.ajax({
              type: 'GET',
              url: 'http://localhost:3000/cercaRicette',
              data: 'ingredienti=' + JSON.stringify({ 'ingredienti': ingredienti }),
              datatype: 'json',
              success: function (data) {

                var result=JSON.parse(data)

                  //Visualizzo le ricette trovate
                  var div = document.getElementById("lista_ricette")
                  //div.innerHTML = ""
                  var ul = document.createElement('ul')

                  if (result.length == 0 ) {
                    document.getElementById('lista_ricette').innerHTML='Nessuna ricetta trovata...'
                  } else {
                    for (var i = 0; i < result.length; i++) {
                        const ricetta = result.ricette[i]

                        var li = document.createElement('li')
                        var button = document.createElement('button')
                        button.onclick = function () {

                            document.getElementById("ricetta_dettaglio").innerHTML='ciao'
                            console.log('ciao')

                        }
                        button.innerHTML=ricetta
                        
                        li.appendChild(button)
                        ul.appendChild(li)
                    }
                    var new_div = document.createElement('div')
                    new_div.appendChild(ul)
                    //se aggiungo piu ingredienti, stampo la lista di ricette attuali e sostituisco quella precedente.
                    //fix: prima veniva appesa a quella precedente
                    document.getElementById('lista_ricette').innerHTML=new_div.innerHTML
                  }

              }
          });

        }

        //Prendo l'ingrediente inserito, lo aggiungo alla lista e faccio la richiesta ajax
        function add_ingredient() {
            const text_field = document.getElementById('ingrediente');
            const ingr = text_field.value
            text_field.value = ""

            //Se un ingrediente è già presente nella lista non lo aggiungo
            if(!ingredienti.includes(ingr) && ingr != '') {
                ingredienti.push(ingr)

                //Visualizzo gli ingredienti. Se premo su un ingrediente lo rimuovo dalla lista
                var span = document.getElementById('lista_ingredienti')
                var button = document.createElement('button')
                button.textContent = ingr
                button.id = ingr
                button.onclick = function () {

                    for (j = 0; j < ingredienti.length; j++) {
                        if (ingredienti[j] == ingr) {
                            ingredienti.splice(j, 1)
                            const ingr_list = document.getElementById('lista_ingredienti')
                            const i = document.getElementById(ingr)
                            ingr_list.removeChild(i)

                            console.log(ingredienti)
                        }
                    }

                    cercaRicette()

                }
                span.appendChild(button)
            }

            //Richiesta ajax per ottenere le ricette
            cercaRicette()
        }

    </script>
</html>
